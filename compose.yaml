x-values:
  tailscale: &tailscale
    network_mode: service:tailscale
    depends_on:
      - tailscale

  environment: &common-environment
    - PUID=1000
    - PGID=1000
    - TZ=Europe/Berlin

services:
  tailscale:
    image: tailscale/tailscale:v1.90.6@sha256:8eb8b450a85856807e8a216c4697333e15f8701cb6d344bed851bf6aa6a9605c
    hostname: homelab
    env_file:
      - .env
    environment:
      TS_SERVE_CONFIG: "/serveconfig/serveconfig.json"
      TS_STATE_DIR: /var/lib/tailscale
      TS_USERSPACE: false
    volumes:
      - ./state/tailscale:/var/lib/tailscale
      - ./config/tailscale:/serveconfig
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    post_start:
      - command: /serveconfig/advertise-services.sh

  prowlarr:
    !!merge <<: *tailscale
    image: linuxserver/prowlarr:2.3.0.5236-ls131@sha256:484784daaf4c081e55c608de256870184d283762e1b64e8105af487b1510fc4a
    environment: *common-environment
    volumes:
      - /mnt/storage:/storage
      - ./state/prowlarr:/config
    restart: unless-stopped

  radarr:
    !!merge <<: *tailscale
    image: linuxserver/radarr:6.0.4.10291-ls287@sha256:e26fbfd3782520c0bb820666f041ca056acfe187a8b95214ee1f47512cc05a29
    environment: *common-environment
    volumes:
      - /mnt/storage:/storage
      - ./state/radarr:/config
    restart: unless-stopped

  sonarr:
    !!merge <<: *tailscale
    image: linuxserver/sonarr:4.0.16.2944-ls297@sha256:4b8a853b76337cd5de5f69961e23b7d0792ce7bf0a8be083dd7202ef670bfc34
    environment: *common-environment
    volumes:
      - /mnt/storage:/storage
      - ./state/sonarr:/config
    restart: unless-stopped

  nzbget:
    !!merge <<: *tailscale
    image: linuxserver/nzbget:v25.4-ls219@sha256:ac2762012e5d4c98da301ffa46d06cbd745273519778b9794884a5d513a0a2ca
    environment: *common-environment
    volumes:
      - /mnt/storage:/storage
      - ./state/nzbget:/config
      - ./state/nzbget-data:/volume
    restart: unless-stopped

  qbittorrent:
    !!merge <<: *tailscale
    image: linuxserver/qbittorrent:5.1.2-r3-ls423@sha256:3908cec5685242ab49b4842124df38c7ff09f82e543c17e0f81e883788f6a611
    environment: *common-environment
    volumes:
      - /mnt/storage:/storage
      - ./state/qbittorrent:/config
    restart: unless-stopped
